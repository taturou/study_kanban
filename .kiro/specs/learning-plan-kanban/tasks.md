# Implementation Plan

- [x] 1. DevContainer 環境を整備し推奨拡張を導入する
- [x] 1.1 Node/TypeScript など依存のプリインストールと推奨拡張の自動インストールを設定する
  - VS Code Dev Container を構成し、ホスト依存を排除する
  - _Requirements: 9.1,9.2,9.3_

- [x] 2. (P) CI/CD とリポジトリ設定を整備する
  - main への push で lint/test/build、成功時に Pages へデプロイし結果を通知する
  - gh スクリプトでブランチ保護・マージ方式・Pages 設定を適用する
  - github ページを手動で設定するための手順を doc/github.md に記載する
  - _Requirements: 5.2,5.12,8.1,8.2,8.3,8.4_

- [x] 3. (P) i18n 基盤を `ja-JP` 固定で構築し、全 UI 文字列をライブラリ管理に移行する
  - 言語切替 UI を出さず、内部 lang を固定して文言を集約する
  - _Requirements: 7.1,7.2_

- [x] 4. カンバンビューとスプリント枠組み
- [x] 4.1 Kanban コンテナ/ヘッダーの分離と縦横スクロール、ステータス固定グリッドと最小幅、挿入プレビューを性能基準（教科14×各セル35枚）で成立させる
  - ヘッダー固定＋左右スクロールを実装し、空白ドラッグでスクロールできるようにする
  - ステータス列と教科列をピン留めし、初期表示はカンバンのみのナビゲーションにする
  - 教科14×各セル35枚でも DnD/スクロール/プレビューが破綻しないことを確認する
  - _Requirements: 1.1,1.3,1.9,1.10,1.11,1.12_
- [x] 4.2 スプリントを月曜始まり1週間で初期化し、開始日/終了日を表示する
  - スプリント選択時の初期化フローを実装し、ヘッダーに期間を表示する
  - _Requirements: 1.2_
- [x] 4.3 教科行の並び替え保存と削除禁止を実装し、スプリント単位で反映する
  - 並び順変更を保存・復元し、タスクがある教科の削除をブロックして理由を通知する
  - _Requirements: 1.6,1.7_
- [x] 4.4 ステータス表示名設定とバージョン表示を SettingsPanel に組み込み、固定列のロック状態を反映する
  - 表示文字列の変更を保存し、固定ステータスの追加/削除/並び替えを不可にする
  - _Requirements: 1.4,1.5_
- [ ] 4.5 Backlog のプラス操作でタスク作成ダイアログ（個別/一括）を教科選択済みで開く
  - Backlog 列からモード切替付きでダイアログを起動し、教科入力を省略できるようにする
  - _Requirements: 1.8_
- [ ] 4.6 フロント最小実装を用意し、画面を随時確認できるようにする
  - Vite + React の dev サーバを起動できる状態にし、AppShell/Kanban スケルトンを表示する
  - 最小のルーティングと UI プレースホルダーを配置し、以降のタスクで段階的に組み込めるようにする
  - _Requirements: 1.3_

- [ ] 5. タスクカードとダイアログ
- [ ] 5.1 TaskDialog の新規/編集フロー（入力、フォーカス、ショートカット、保存/キャンセル/消去）を実装する
  - タイトル初期フォーカスと Tab ナビゲーション、Ctrl+Enter 保存/Esc キャンセルを実現する
  - 保存/キャンセル/消去の操作を提供し、作成/更新時に対象セル末尾へ追加する
  - _Requirements: 2.1,2.2,2.4,2.5,2.6,2.7_
- [ ] 5.2 実績時間の記録・累積・手動修正を TDialog で扱えるようにする
  - 日付単位の実績を追加/編集/削除し、累積を表示する
  - _Requirements: 2.8,2.9_
- [ ] 5.3 TCard の表示（タイトル/期日/予定・実績ゲージ）と形状（通常は横長、InPro は正方形）を実装する
  - 予定/実績ゲージと期日（曜日）を描画し、InPro 以外で共通ゲージを持たせる
  - _Requirements: 2.3,3.6,3.7_

- [ ] 6. ステータス遷移と DnD ガード
- [ ] 6.1 StatusPolicy で Today 先頭/OnHold 先頭のみ InPro 遷移可、InPro 唯一性、Done 遷移ガード、自動 OnHold 退避（優先度保持要件含む）を実装する
  - Today 最優先以外→InPro 拒否、OnHold 先頭のみ InPro 許可、InPro 置換時は OnHold 先頭へ退避し優先度を再採番する
  - InPro/OnHold 以外→Done を拒否し、ステータス固定列のロックを遵守する
  - _Requirements: 1.4,3.1,3.8,3.9,3.10,3.11,3.12,3.16_
- [ ] 6.2 DnD UI で有効セルのみハイライト、挿入位置に従った優先度保存、タッチ/マウス操作をサポートする
  - ドロップ前にポリシー結果を確認し、無効セル/insertIndex はドロップ不可にする
  - 同一セル並び替えと別セル移動で優先度を再計算し保存する
  - _Requirements: 3.2,3.3,3.4,3.5_
- [ ] 6.3 InPro 置換・競合時の優先度正規化と OnHold 配置を TaskStore/Sync 側で統合する
  - InProAutoTracker の退避副作用と PrioritySorter の整合を取り、競合で複数 InPro が出た場合は発見順に OnHold 先頭へ積む
  - _Requirements: 3.9,3.12,3.16_

- [ ] 7. 時間計測とポモドーロ・負荷通知
- [ ] 7.1 InPro 自動計測をバッチ反映し、円形インジケーターとゲージ更新を行う
  - 1 分刻みは UI ローカルに蓄積し、退出/一定間隔で実績にまとめて反映する
  - _Requirements: 3.12,3.13_
- [ ] 7.2 ポモドーロタイマーの設定/開始/一時停止/リセットと開始・終了・休憩のトースト通知、終了アラームを実装する
  - アラームの消音/再通知選択を提供し、作業/休憩時間を設定可能にする
  - _Requirements: 3.14,3.15_
- [ ] 7.3 Today/InPro/OnHold の残り時間合計を計算し、過負荷トーストとカンバン上部の残り学習可能時間ゲージに反映する
  - 学習可能時間と予定時間を組み合わせてゲージ表示し、超過時は非モーダルに警告する
  - _Requirements: 3.12,4.12_

- [ ] 8. カレンダー・ダッシュボード・バーンダウン
- [ ] 8.1 週次ダッシュボードでステータス/教科別集計とバーンダウンを表示し、完了数と学習時間を週次サマリで示す
  - スプリント期間の残作業量を日次でプロットし、完了タスク数・学習時間を集計する
  - _Requirements: 1.2,4.1,4.4,4.13,4.17_
- [ ] 8.2 期日迫近/超過の強調と当日追加タスク・実施タスクの一覧を日付ビューに表示する
  - Backlog の期日当日を強調し、期限超過リストと当日追加/実施/期日タスク一覧を提供する
  - _Requirements: 4.2,4.3,4.8,4.14_
- [ ] 8.3 カレンダー（月曜始まり）でスプリント選択と予定表示、学習可能時間のデフォルト/日次上書きを扱う
  - currentSprintId をローカル保持し、予定は表示のみで学習可能時間は手動入力を優先する
  - _Requirements: 4.5,4.9,4.10,4.11,4.12,4.16_
- [ ] 8.4 Google Calendar 連携の取得/双方向同期とオンライン時のみの更新受付、オフライン時の再試行導線を実装する
  - 選択カレンダーの予定取得と差分同期を行い、オフライン時は入力を拒否して再試行を促す
  - _Requirements: 4.6,4.7,4.11_
- [ ] 8.5 ヘルプページを用意し、主要操作説明への導線を SettingsPanel から提供する
  - カンバン操作、ステータス遷移ルール、ダイアログ、カレンダー、時間設定の説明を掲載する
  - _Requirements: 4.15_

- [ ] 9. 同期・永続化・更新・バックアップ・PWA
- [ ] 9.1 IndexedDB 永続と dirty/batch ポリシーでオフライン編集と再同期を成立させる
  - スナップショット保存と dirty 管理、オフライン時の保存と再接続時のアップロードを実装する
  - _Requirements: 5.4,5.5_
- [ ] 9.2 SyncEngine/DriveAdapter で認証後の Drive 保存、専用ディレクトリ分割、schemaVersion 検証・マイグレーション、将来の API 拡張性を備える
  - Drive へのファイル分割保存と schemaVersion マイグレーション、未知/失敗時の停止ダイアログを実装する
  - _Requirements: 5.3,5.7,5.10,5.11,5.15,5.16_
- [ ] 9.3 PWA インストール・Service Worker・バージョン自動/手動チェックと強制アップデートを実装し、Pages 配信前提のビルドを整える
  - version.json を用いた更新検知と強制更新の適用、手動チェックを SettingsPanel から呼び出せるようにする
  - _Requirements: 5.1,5.2,5.8,5.9,5.14_
- [ ] 9.4 同期状態のトースト通知と手動同期トリガーを SettingsPanel から提供する
  - 同期中/失敗/完了を非モーダル表示し、再試行操作を付与する
  - _Requirements: 5.6_
- [ ] 9.5 BackupService で日次/週次スナップショット取得・保持・復元フローを整備する
  - retention に基づく保存・削除と、復元時の同期一時停止/再開フローを実装する
  - _Requirements: 5.13_

- [ ] 10. 通知と閲覧専用モード
- [ ] 10.1 AlertToast を同期/ポモドーロ/過負荷などのイベントに統合し、非モーダル通知を提供する
  - 各イベントのメッセージと再試行/消音などの操作をまとめる
  - _Requirements: 3.12,3.13,3.14,5.6_
- [ ] 10.2 閲覧専用モードの招待/無効化と自動更新、オフライン時キャッシュ表示を実装する
  - 共有リンク発行/遮断、閲覧専用 PWA、定期 pull とオフライン表示を提供する
  - _Requirements: 6.1,6.2,6.3,6.4_

- [ ] 11. テスト・検証
- [ ] 11.1 StatusPolicy/TimeCalc/Availability/Sync 周辺のユニット・統合テストを実装する
  - 遷移ガード、優先度計算、残り時間計算、dirty/batch 処理をカバーする
  - _Requirements: 2.3,3.1,3.2,3.3,3.4,3.8,3.9,3.10,3.11,3.12,3.16,4.12,5.4,5.5_
- [ ] 11.2 DnD/タスク編集/カレンダー/閲覧専用/オフライン同期の E2E シナリオを追加する
  - DnD 制約、ダイアログ操作、カレンダー双方向同期、閲覧専用表示、オフライン編集→再同期を通しで検証する
  - _Requirements: 1.3,1.8,2.1,2.2,2.6,2.7,4.5,4.6,4.7,4.8,4.11,6.2,6.3,6.4_
- [ ] 11.3 性能・PWA/更新・バックアップの検証を行う
  - 14 教科×各セル 35 枚の DnD/スクロール、PWA インストールと更新、バックアップ/復元フローを確認する
  - _Requirements: 1.12,5.1,5.8,5.9,5.13_
