# Implementation Plan

- [x] 2. (P) CI/CD とリポジトリ設定を整備する
  - main への push で lint/test/build、成功時に Pages へデプロイし結果を通知する
  - gh スクリプトでブランチ保護・マージ方式・Pages 設定を適用する
  - github ページを手動で設定するための手順を doc/github.md に記載する
  - _Requirements: 5.2,5.12,8.1,8.2,8.3,8.4_

- [x] 3. (P) i18n 基盤を `ja-JP` 固定で構築し、全 UI 文字列をライブラリ管理に移行する
  - 言語切替 UI を出さず、内部 lang を固定して文言を集約する
  - _Requirements: 7.1,7.2_

- [x] 4. カンバンビューとスプリント枠組み
- [x] 4.1 Kanban コンテナ/ヘッダーの分離と縦横スクロール、ステータス固定グリッドと最小幅、挿入プレビューを性能基準（教科14×各セル35枚）で成立させる
  - ヘッダー固定＋左右スクロールを実装し、空白ドラッグでスクロールできるようにする
  - ステータス列と教科列をピン留めし、初期表示はカンバンのみのナビゲーションにする
  - 教科14×各セル35枚でも DnD/スクロール/プレビューが破綻しないことを確認する
  - _Requirements: 1.1,1.3,1.9,1.10,1.11,1.12_
- [x] 4.2 スプリントを月曜始まり1週間で初期化し、開始日/終了日を表示する
  - スプリント選択時の初期化フローを実装し、ヘッダーに期間を表示する
  - _Requirements: 1.2_
- [x] 4.3 教科行の並び替え保存と削除禁止を実装し、スプリント単位で反映する
  - 並び順変更を保存・復元し、タスクがある教科の削除をブロックして理由を通知する
  - _Requirements: 1.6,1.7_
- [x] 4.4 ステータス表示名設定とバージョン表示を SettingsPanel に組み込み、固定列のロック状態を反映する
  - 表示文字列の変更を保存し、固定ステータスの追加/削除/並び替えを不可にする
  - _Requirements: 1.4,1.5_
- [x] 4.5 Backlog のプラス操作でタスク作成ダイアログ（個別/一括）を教科選択済みで開く
  - Backlog 列からモード切替付きでダイアログを起動し、教科入力を省略できるようにする
  - _Requirements: 1.8_
- [x] 4.6 フロント最小実装を用意し、画面を随時確認できるようにする
  - Vite + React の dev サーバを起動できる状態にし、AppShell/Kanban スケルトンを表示する
  - 最小のルーティングと UI プレースホルダーを配置し、以降のタスクで段階的に組み込めるようにする
  - _Requirements: 1.3_

- [x] 5. タスクカードとダイアログ
- [x] 5.1 TaskDialog の新規/編集フロー（入力、フォーカス、ショートカット、保存/キャンセル/消去）を実装する
  - タイトル初期フォーカスと Tab ナビゲーション、Ctrl+Enter 保存/Esc キャンセルを実現する
  - 保存/キャンセル/消去の操作を提供し、作成/更新時に対象セル末尾へ追加する
  - _Requirements: 2.1,2.2,2.4,2.5,2.6,2.7_
- [x] 5.2 実績時間の記録・累積・手動修正を TDialog で扱えるようにする
  - 日付単位の実績を追加/編集/削除し、累積を表示する
  - _Requirements: 2.8,2.9_
- [x] 5.3 TCard の表示（タイトル/期日/予定・実績ゲージ）と形状（通常は横長、InPro は正方形）を実装する
  - 予定/実績ゲージと期日（曜日）を描画し、InPro 以外で共通ゲージを持たせる
  - _Requirements: 2.3,3.6,3.7_

- [x] 6. KanbanBoard 基盤と UI 整備
- [x] 6.1 KanbanBoard のレンダリング基盤を実装する
  - KanbanBoard コンポーネントを作成し、固定ステータス×教科のグリッドを描画する
  - プレースホルダーの TCard を Status/Subject ごとに表示し、スクロールとピン留め設定を反映する
  - _Requirements: 1.1,1.9,1.10,1.11_
- [x] 6.2 KanbanBoard の見た目を UI スケッチに合わせて整える
  - design.md の「UI レイアウト（ASCII スケッチ）」を参考に、AppShell/KanbanView のレイアウト・配色・固定ヘッダー/ピン留め・スクロール表現を整備する
  - 初期状態でもヘッダー/ナビ/ボード/プレースホルダーがスケッチに近い見た目になるよう CSS を適用する
  - _Requirements: 1.1,1.3,1.9,1.10,1.11_
- [x] 6.3 KanbanBoard スタイルとトークンを共通化する
  - ステータス列幅や色などの UI 定数を CSS 変数にまとめ、AppShell/KanbanView のスタイルを専用 CSS へ切り出す
  - 横スクロールのビジュアルや固定ヘッダー/ピン留めを視覚的に確認できるようにする
  - _Requirements: 1.1,1.3,1.9,1.10,1.11_
- [x] 6.4 AppShell / KanbanHeader をスケッチ準拠の構成にする
  - AppBar のメニュー/ロゴ/日付/ビュー切替/同期状態/アバターと、Kanban Header の Today/Done 数・学習可能時間ゲージ・ポモドローボタンのプレースホルダーを配置する
  - ボードの横スクロール時も AppBar/Kanban Header が固定表示されるようにする
  - _Requirements: 1.1,1.3,1.9,1.10,1.11,4.12_
- [x] 6.5 スクロール・ピン留めの視覚表現を整える
  - ヘッダー/ステータス列/教科列のピン留めに境界線・影などの視覚処理を入れ、横スクロールの方向や位置を認識しやすくする
  - 最小列幅とステータス列の横スクロールをレスポンシブに調整し、モバイル/タブレットでもスケッチに近い見た目を保つ
  - _Requirements: 1.1,1.9,1.10,1.11_

- [x] 7. E2Eテスト (AI-driven via Chrome DevTools MCP)
- [x] 7.1 AIエージェントが chrome-devtools-mcp を介してブラウザを直接操作するためのテスト基盤を構築する
- [x] 7.2 AIエージェントにDOMの状態（アクセシビリティツリーやレイアウト）を認識させ、視覚的な変化をアサーションする機能を実装する
- [x] 7.3 主要なユーザーフロー（タスク作成、DnD）を対象に、AIエージェントが自律的に操作・検証するテストシナリオを作成し、CIで実行できるようにする
- [ ] 7.4 (P) Task 3～6の完了機能に対し、AI E2Eテストを実行してリグレッションと欠陥を修正する

- [x] 8. カンバン横幅レスポンシブ仕様の実装
- [x] 8.1 requirements/design に基づき、教科列固定幅＋ステータス列のリサイズルール（広い場合は均等割り、狭い場合は Today/InPro/OnHold を固定幅、Backlog/Done/WontFix を狭める、極端に狭い場合はボード全体横スクロール）を設計反映する
- [x] 8.2 KanbanBoard/スタイルを実装し、ステータス行を固定しつつ縦スクロールのみで操作できるようにする（教科列の sticky は行わない）
- [x] 8.3 レイアウト崩れ・幅ずれ・重なりの回避を確認するためのテストまたはスナップショットを追加し、開発環境で表示確認する

- [x] 9. ステータス遷移と DnD ガード
- [x] 9.1 StatusPolicy で Today 先頭/OnHold 先頭のみ InPro 遷移可、InPro 唯一性、Done 遷移ガード、自動 OnHold 退避（優先度保持要件含む）を実装する
  - Today 最優先以外→InPro 拒否、OnHold 先頭のみ InPro 許可、InPro 置換時は OnHold 先頭へ退避し優先度を再採番する
  - InPro/OnHold 以外→Done を拒否し、ステータス固定列のロックを遵守する
  - _Requirements: 1.4,3.1,3.8,3.9,3.10,3.11,3.12,3.16_
- [x] 9.2 DnD UI で有効セルのみハイライト、挿入位置に従った優先度保存、タッチ/マウス操作をサポートする
  - ドロップ前にポリシー結果を確認し、無効セル/insertIndex はドロップ不可にする
  - 同一セル並び替えと別セル移動で優先度を再計算し保存する
  - _Requirements: 3.2,3.3,3.4,3.5_
- [x] 9.3 InPro 置換・競合時の優先度正規化と OnHold 配置を TaskStore/Sync 側で統合する
  - InProAutoTracker の退避副作用と PrioritySorter の整合を取り、競合で複数 InPro が出た場合は発見順に OnHold 先頭へ積む
  - _Requirements: 3.9,3.12,3.16_

- [x] 10. Task 3〜9 の UI 実装を実体化する
  - 既存のロジック/スケルトンを、実データ連動と UI 表示に統合する
  - _Requirements: 1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3.1,3.2,3.3,3.4,3.5,3.6,3.7,3.8,3.9,3.10,3.11,3.12,3.16,7.1,7.2_
- [x] 10.1 TaskDialog を UI と状態管理で実装し、タスク作成/編集/実績入力を実動作させる
  - タイトル初期フォーカス、Tab 移動、保存/キャンセル/消去、実績の追加/修正/累積表示を統合する
  - _Requirements: 2.1,2.2,2.4,2.5,2.6,2.7,2.8,2.9_
- [x] 10.2 TCard の表示を UI とデータで完成させる（タイトル/期日/予定・実績ゲージ/形状）
  - InPro の正方形・非 InPro の棒ゲージを描画し、期日や曜日を含めたカード表示にする
  - _Requirements: 2.3,3.6,3.7_
- [x] 10.3 KanbanBoard をタスクデータと DnD に接続し、ポリシーに従って移動・並び替えを反映する
  - StatusPolicy/TaskStore と UI を結合し、禁止理由の通知や優先度保存を行う
  - _Requirements: 3.1,3.2,3.3,3.4,3.5,3.8,3.9,3.10,3.11,3.16_
- [x] 10.4 SettingsPanel と教科行操作を UI に接続し、表示名変更と並び順/削除制御を実動作させる
  - ステータス表示名の保存、教科行の並び替え保存、タスク付き教科の削除ブロックを実装する
  - _Requirements: 1.4,1.5,1.6,1.7_
- [x] 10.5 スプリント初期化とヘッダー表示を UI に統合する
  - 月曜始まり 1 週間の開始/終了日を表示し、スプリント単位の状態を反映する
  - _Requirements: 1.2_
- [x] 10.6 TDialog でのタスク消去機能を有効化する
  - 消去ボタンでタスクを削除し、ダイアログを閉じる
  - _Requirements: 2.6_
- [x] 10.7 TDialog で Ctrl+Enter による保存を有効化する
  - Ctrl+Enter で保存ボタンと同等の処理を行う
  - _Requirements: 2.7_

- [x] 11. 時間計測とポモドーロ・負荷通知
- [x] 11.1 InPro 自動計測をバッチ反映し、円形インジケーターとゲージ更新を行う
  - 1 分刻みは UI ローカルに蓄積し、退出/一定間隔で実績にまとめて反映する
  - _Requirements: 3.12,3.13_
- [x] 11.2 ポモドーロタイマーの設定/開始/一時停止/リセットと開始・終了・休憩のトースト通知、終了アラームを実装する
  - アラームの消音/再通知選択を提供し、作業/休憩時間を設定可能にする
  - _Requirements: 3.14,3.15_
- [x] 11.3 Today/InPro/OnHold の残り時間合計を計算し、過負荷トーストとカンバン上部の残り学習可能時間ゲージに反映する
  - 学習可能時間と予定時間を組み合わせてゲージ表示し、超過時は非モーダルに警告する
  - _Requirements: 3.12,4.12_

- [ ] 12. カレンダー・ダッシュボード・バーンダウン
- [ ] 12.1 週次ダッシュボードでステータス/教科別集計とバーンダウンを表示し、完了数と学習時間を週次サマリで示す
  - スプリント期間の残作業量を日次でプロットし、完了タスク数・学習時間を集計する
  - _Requirements: 1.2,4.1,4.4,4.13,4.17_
- [ ] 12.2 期日迫近/超過の強調と当日追加タスク・実施タスクの一覧を日付ビューに表示する
  - Backlog の期日当日を強調し、期限超過リストと当日追加/実施/期日タスク一覧を提供する
  - _Requirements: 4.2,4.3,4.8,4.14_
- [ ] 12.3 カレンダー（月曜始まり）でスプリント選択と予定表示、学習可能時間のデフォルト/日次上書きを扱う
  - currentSprintId をローカル保持し、予定は表示のみで学習可能時間は手動入力を優先する
  - _Requirements: 4.5,4.9,4.10,4.11,4.12,4.16_
- [ ] 12.4 Google Calendar 連携の取得/双方向同期とオンライン時のみの更新受付、オフライン時の再試行導線を実装する
  - 選択カレンダーの予定取得と差分同期を行い、オフライン時は入力を拒否して再試行を促す
  - _Requirements: 4.6,4.7,4.11_
- [ ] 12.5 ヘルプページを用意し、主要操作説明への導線を SettingsPanel から提供する
  - カンバン操作、ステータス遷移ルール、ダイアログ、カレンダー、時間設定の説明を掲載する
  - _Requirements: 4.15_

- [ ] 13. 同期・永続化・更新・バックアップ・PWA
- [ ] 13.1 IndexedDB 永続と dirty/batch ポリシーでオフライン編集と再同期を成立させる
  - スナップショット保存と dirty 管理、オフライン時の保存と再接続時のアップロードを実装する
  - _Requirements: 5.4,5.5_
- [ ] 13.2 SyncEngine/DriveAdapter で認証後の Drive 保存、専用ディレクトリ分割、schemaVersion 検証・マイグレーション、将来の API 拡張性を備える
  - Drive へのファイル分割保存と schemaVersion マイグレーション、未知/失敗時の停止ダイアログを実装する
  - _Requirements: 5.3,5.7,5.10,5.11,5.15,5.16_
- [ ] 13.3 PWA インストール・Service Worker・バージョン自動/手動チェックと強制アップデートを実装し、Pages 配信前提のビルドを整える
  - version.json を用いた更新検知と強制更新の適用、手動チェックを SettingsPanel から呼び出せるようにする
  - _Requirements: 5.1,5.2,5.8,5.9,5.14_
- [ ] 13.4 同期状態のトースト通知と手動同期トリガーを SettingsPanel から提供する
  - 同期中/失敗/完了を非モーダル表示し、再試行操作を付与する
  - _Requirements: 5.6_
- [ ] 13.5 BackupService で日次/週次スナップショット取得・保持・復元フローを整備する
  - retention に基づく保存・削除と、復元時の同期一時停止/再開フローを実装する
  - _Requirements: 5.13_

- [ ] 14. 通知と閲覧専用モード
- [ ] 14.1 AlertToast を同期/ポモドーロ/過負荷などのイベントに統合し、非モーダル通知を提供する
  - 各イベントのメッセージと再試行/消音などの操作をまとめる
  - _Requirements: 3.12,3.13,3.14,5.6_
- [ ] 14.2 閲覧専用モードの招待/無効化と自動更新、オフライン時キャッシュ表示を実装する
  - 共有リンク発行/遮断、閲覧専用 PWA、定期 pull とオフライン表示を提供する
  - _Requirements: 6.1,6.2,6.3,6.4_

- [ ] 15. テスト・検証
- [ ] 15.1 StatusPolicy/TimeCalc/Availability/Sync 周辺のユニット・統合テストを実装する
  - 遷移ガード、優先度計算、残り時間計算、dirty/batch 処理をカバーする
  - _Requirements: 2.3,3.1,3.2,3.3,3.4,3.8,3.9,3.10,3.11,3.12,3.16,4.12,5.4,5.5_
- [ ] 15.2 Task 7のAIテスト基盤を用いて、Task 9-14で実装した機能（DnD, カレンダー, 同期等）のE2Eシナリオを実装・検証する
  - DnD 制約、ダイアログ操作、カレンダー双方向同期、閲覧専用表示、オフライン編集→再同期を通しで検証する
  - _Requirements: 1.3,1.8,2.1,2.2,2.6,2.7,4.5,4.6,4.7,4.8,4.11,6.2,6.3,6.4_
- [ ] 15.3 性能・PWA/更新・バックアップの検証を行う
  - 14 教科×各セル 35 枚の DnD/スクロール、PWA インストールと更新、バックアップ/復元フローを確認する
  - _Requirements: 1.12,5.1,5.8,5.9,5.13_
