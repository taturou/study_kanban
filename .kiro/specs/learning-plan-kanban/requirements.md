# Requirements Document

## Introduction
学習目標と学習タスクをカンバン形式で整理し、進捗を可視化・調整することで、計画的な学習を支援する。

## Requirements

### Requirement 1: カンバンボード構造とスプリント管理
**Objective:** 学習者として、全教科の進捗を一目で把握するために、ステータスと教科が整理されたカンバンボードを持ちたい。

#### Acceptance Criteria
1. When 学習計画カンバンがボードを表示するとき, the 学習計画カンバン shall ステータス列（「明日以降にやる」「今日やる」「勉強中」「一旦休憩」「終わった」「やらない」）と教科行による固定の2次元グリッドで単一ボードを構成する。
2. When スプリントを初期化するとき, the 学習計画カンバン shall スプリント長を月曜始まりの1週間に固定し開始日と終了日を表示する。
3. The 学習計画カンバン shall 初期表示をカンバンのみに限定し、メニューまたはアイコンクリック時のみ追加情報を表示する。
4. The 学習計画カンバン shall ステータス列の順序・名称・数を変更不可にロックし、どの画面でも追加/削除や並べ替えを許可しない。
5. While 学習者が設定で教科の並び順を変更するとき, the 学習計画カンバン shall スプリント単位で新しい教科行順を保存しボードに反映する。
6. If 学習者がタスクを含む教科行を削除しようとする, the 学習計画カンバン shall 削除を禁止し理由を通知する。
7. When 学習者が「明日以降にやる」セルのプラス操作を行う, the 学習計画カンバン shall タスク作成ダイアログを開く。
8. When 学習者が空セルや余白をドラッグする, the 学習計画カンバン shall ボードをスクロールしつつステータスヘッダー行と教科名の左端列を固定表示する。

### Requirement 2: タスクカード作成と編集
**Objective:** 学習者として、学習内容と締切を正確に登録・更新するために、詳細なタスクカードを扱いたい。

#### Acceptance Criteria
1. When 学習者が新規タスクダイアログを開く, the 学習計画カンバン shall タイトル・説明・目標成果・期日・見積学習時間・優先度の入力と保存を受け付ける。
2. When 学習者が既存タスクを開く, the 学習計画カンバン shall 現在値を読込んで編集を可能にし更新内容を保存する。
3. The 学習計画カンバン shall 各タスクカードにタイトル・詳細・期日・予定時間・実績時間を表示する。
4. When タスクダイアログが開く, the 学習計画カンバン shall タイトル入力欄にフォーカスを合わせる。
5. While 学習者がダイアログ内でTab操作を行う, the 学習計画カンバン shall テキストフィールドとボタン間で順次フォーカスを移動する。
6. When 学習者が保存をクリックまたはCtrl+Enterを押下する, the 学習計画カンバン shall タスクを保存する; When 学習者がキャンセルをクリックまたはEscを押下する, the 学習計画カンバン shall 保存せず閉じる。
7. The 学習計画カンバン shall ダイアログに保存・キャンセル・消去の操作を提供する。
8. When 学習者が日付ごとに実績時間を記録する, the 学習計画カンバン shall 累積しカードに総実績時間を表示する。
9. Where 学習者が実績時間を調整する必要がある, the 学習計画カンバン shall ダイアログ内での手動修正を許可する。

### Requirement 3: タスク移動・優先度・時間管理
**Objective:** 学習者として、学習順序と時間を適切に制御するために、ドラッグ移動と時間計測を一貫したルールで運用したい。

#### Acceptance Criteria
1. When 学習者がタスクカードをステータス列や教科行間でドラッグ移動する, the 学習計画カンバン shall タスクを移動し新しいステータスと教科の紐づけを保存する。
2. While タスクをドラッグ中, the 学習計画カンバン shall 有効なドロップセルをハイライトし無効なセルを視覚的にブロックする。
3. The 学習計画カンバン shall 各セル内のタスクを優先度の高い順に並べ、優先度変更時に順序を再計算する。
4. When 学習者が同一セル内で並び替える, the 学習計画カンバン shall カスタム順序を保存し次回表示でも維持する。
5. The 学習計画カンバン shall マウス（PC）とタッチ（タブレット）の両方でドラッグ＆ドロップをサポートする。
6. If 学習者が「今日やる」で最優先以外のタスクを同一教科内の「勉強中」へ移動しようとする, the 学習計画カンバン shall 遷移を拒否する。
7. While あるタスクが「勉強中」にある, the 学習計画カンバン shall それを唯一のタスクとして保持し、別タスクが入るときは元のタスクを自動で「一旦休憩」へ移動する。
8. If 学習者が「勉強中」「一旦休憩」以外から「終わった」へ移動しようとする, the 学習計画カンバン shall 遷移をブロックする。
9. If 「今日やる」列の予定時間または実績時間合計が当日の学習可能時間を超える, the 学習計画カンバン shall 非モーダルのアラートを表示し操作を継続可能とする。
10. While タスクが「勉強中」にある, the 学習計画カンバン shall 経過時間を自動計測し実績時間に反映し、非モーダルで計測中を表示する。
11. The 学習計画カンバン shall 「勉強中」タスクをグラフィカルなタイマーで視覚化する。
12. When 学習者がポモドーロタイマーを操作する, the 学習計画カンバン shall 作業/休憩時間の設定と開始・一時停止・リセットを可能にし、開始/終了/休憩開始を非モーダル通知する。
13. Where ポモドーロセッションが終了する, the 学習計画カンバン shall アラーム（音または視覚）を鳴らし消音または再通知を選択可能にする。

### Requirement 4: スケジュール可視化とカレンダー
**Objective:** 学習者として、負荷と期限を調整するために、進捗と予定をまとめて確認したい。

#### Acceptance Criteria
1. When 学習者がダッシュボードを開く, the 学習計画カンバン shall 週次スプリントの進捗を教科別・ステータス別に集計表示する。
2. If タスク期日が7日以内に迫る, the 学習計画カンバン shall 期限迫近インジケータでカードを強調する。
3. If タスクが期日超過で未完了, the 学習計画カンバン shall 期限超過としてフラグし期限超過リストに掲載する。
4. The 学習計画カンバン shall スプリント中の残作業量（タスク数または見積時間）を日次でプロットするバーンダウンチャートを提供する。
5. The 学習計画カンバン shall 月曜始まり固定のカレンダーでスプリントを選択・切替できるようにする。
6. When 学習者が特定日を閲覧する, the 学習計画カンバン shall 「その日に実施したタスク」「その日が期日のタスク」「その日に追加したタスク」を一覧表示する。
7. Where 曜日ごとの作業可能時間が設定されている, the 学習計画カンバン shall それをデフォルト学習可能時間として適用する。
8. When 学習者が特定日の作業可能時間を上書きする, the 学習計画カンバン shall 当日の計画に上書き値を反映する。
9. Where 学習者が予定（非学習を含む）を登録する, the 学習計画カンバン shall 当日の学習可能時間表示に反映する。
10. The 学習計画カンバン shall カンバン上部など視認性の高い位置に当日の予定と残り学習可能時間を表示する。
11. The 学習計画カンバン shall 当日が期日のタスクをボード上で視覚的に強調する。
12. The 学習計画カンバン shall 教科ごとの完了タスク数と学習時間を週次サマリとして提示し次スプリント計画に利用できるようにする。
13. When 「その日に追加したタスク」を表示するとき, the 学習計画カンバン shall スプリント計画（主に日曜）で追加したタスクを除外し当日追加分のみ含める。
14. The 学習計画カンバン shall 主要操作（タスク作成・移動、ステータス遷移ルール、ダイアログ操作、カレンダー利用、時間設定）を説明するヘルプページを提供する。
15. When 学習者がカレンダーで週次/日次の学習時間推移を閲覧する, the 学習計画カンバン shall 予定時間と実績時間をグラフで表示する。

### Requirement 5: アプリ基盤・デプロイ・同期
**Objective:** 学習者として、マルチデバイスで途切れず使えるように、PWA・クラウド同期・ブラウザ対応を備えた基盤が欲しい。

#### Acceptance Criteria
1. The 学習計画カンバン shall PWAとしてインストール可能であり、iPad Safari・Google Chrome（PC）・Microsoft Edge（PC）で動作する。
2. The 学習計画カンバン shall GitHub Pagesへデプロイされた環境で利用可能とする。
3. When 学習者がGoogleにサインインする, the 学習計画カンバン shall 認証済みGoogle Drive領域にデータを保存し標準ストレージとする。
4. While オンライン接続中, the 学習計画カンバン shall データをローカルにキャッシュし変更を随時クラウドへ同期する。
5. While オフライン, the 学習計画カンバン shall カンバン操作と閲覧を可能にし、再接続時に変更をクラウドへアップロードする。
6. When 同期状態が変化する（同期中/失敗/完了）, the 学習計画カンバン shall 非モーダルで通知し失敗時は再試行手段を提供する。
7. The 学習計画カンバン shall GitHub Pages配信とGoogle Drive APIで完結するサーバレス構成を採用する。

### Requirement 6: 通知・フィルター・閲覧モード
**Objective:** 学習者・保護者として、重要情報を見逃さず安全に共有するために、通知・フィルター・閲覧専用ビューを使いたい。

#### Acceptance Criteria
1. When 期日が接近する（当日および前日）, the 学習計画カンバン shall 教科別に集約した非モーダルのリマインド通知を送る。
2. The 学習計画カンバン shall カンバンとカレンダーで教科・期日・優先度のフィルターを提供し、適用中のフィルターを明示する。
3. When 学習者が閲覧招待を発行する, the 学習計画カンバン shall 編集不可の閲覧専用リンクまたはGoogleアカウント権限で閲覧を提供する。
4. The 学習計画カンバン shall 閲覧専用PWAモードをPC（Chrome/Edge）、iPad Safari、主要スマートフォンブラウザで利用可能にする。
5. While 閲覧モードにある, the 学習計画カンバン shall リアルタイムまたは一定間隔で自動更新し、オフライン時は最後のキャッシュを表示して再接続時に自動更新する。
6. If 学習者が閲覧招待を無効化する, the 学習計画カンバン shall 招待先からの閲覧を遮断する。

## 1週間の利用フロー（ガイドライン）

### スプリント計画・振り返り（日曜）
- カレンダーで翌週スプリントを選択し、前週の週次サマリを確認して教科別の学習量を振り返る。
- 教科行を確認・追加・削除（タスクがある教科は削除不可）。翌週に不要な教科は日曜のうちに整理。
- 「明日以降にやる」のセルからタスク新規作成ダイアログを開き、翌週分のタスクを登録（タイトルにフォーカス、Tabで移動、Ctrl+Enterで保存）。
- 期日と予定時間を設定し、優先度を付与。バーンダウン初期値を確認し、過負荷にならないよう調整。

### 日次運用（月〜金）
- 朝: 「今日やる」に当日のタスクを優先度順に並べ、最優先のみ「勉強中」に移動（「勉強中」は常に1件）。
- 作業開始: 新規タスクは「明日以降にやる」のセルをクリックして追加。着手するタスクを「勉強中」に移動し、既存の「勉強中」は自動で「一旦休憩」へ。
- 学習中: カードをクリックして編集ダイアログを開き、日付ごとに実績時間を追記。TabやEsc、Ctrl+Enterで効率的に操作。
- ステータス移動: 完了したタスクは「勉強中」または「一旦休憩」からのみ「終わった」へ移動。
- 夕方: バーンダウンと教科別の進捗を確認し、遅延があれば優先度を調整。必要に応じて翌日の「今日やる」候補を整理。

### 週末レビュー（土曜または日曜午前）
- カレンダーの日付ビューで「その日に実施したタスク」「期日のタスク」「その日に追加したタスク」を確認。
- 週次サマリで教科別の完了タスク数・予定/実績時間を振り返り、次週の教科構成とタスクを準備（次の「スプリント計画・振り返り」へ接続）。
- 残タスクを整理し、「やらない」「明日以降にやる」へ再配置し、翌週スプリントで扱うものを確定。

### 追加の改善提案
