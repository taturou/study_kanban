# Requirements Document

## Introduction
学習目標と学習タスクをカンバン形式で整理し、進捗を可視化・調整することで、計画的な学習を支援する。

## Requirements

### Requirement 1: カンバンボードと列管理
**Objective:** 学習者として、全教科の進捗を一目で把握するために、ステータスと教科の2次元で整理されたカンバンボードを持ちたい。

#### Acceptance Criteria
1. 学習計画カンバンは単一のボード上で全教科のタスクを扱い、列をステータス、行を教科とする2次元グリッドで表示する。
2. 画面はデフォルトでカンバンのみを表示し、その他の情報はメニューを開くかアイコンをクリックした場合にのみ表示する。
3. ボード作成時にスプリント期間を1週間（月曜始まり固定）で設定し、現在スプリントの開始日と終了日を表示する。
4. 学習計画カンバンはステータス列を左から「明日以降にやる」「今日やる」「勉強中」「一旦休憩」「終わった」「やらない」の固定順序で表示し、名称・数・順序を変更できないようにする。
5. ステータス行は設定画面でも変更できず、常に固定のステータスを表示する。
6. 「明日以降にやる」の各セルはプラスボタンとして動作し、クリックするとタスク新規作成ダイアログを開く。
7. 教科行の並び順は設定画面で変更でき、保存後はカンバン上に反映されるが、ステータス列の並び順は固定のままとする。
8. カンバン上では教科行やステータス列の並び替えを行えず、設定画面または固定順序をそのまま表示する。
9. 教科は各スプリントごとに管理でき、スプリント開始時および期間中に教科の追加・削除ができる。
10. タスクが存在する教科行を削除しようとした場合、学習計画カンバンは削除を禁止し、その理由を通知する。
11. タスクが存在しないセルや余白をドラッグしたとき、学習計画カンバンはボード全体をスクロール移動させるが、ステータス列のヘッダー行と教科名の左端列は固定表示のまま動かさない。

### Requirement 2: 学習タスクカード管理
**Objective:** 学習者として、学習内容と締切を明確に管理するために、学習タスクカードを詳細に記録・更新したい。

#### Acceptance Criteria
1. 学習者がタスクカードを作成するとき、学習計画カンバンはタイトル、説明、目標成果、期日、見積学習時間、優先度を保存する。
2. タスクカードにはタイトル、詳細、期日、予定時間、実績時間を表示する。
3. タスクカードはステータス列間および教科行間でドラッグ＆ドロップ移動でき、移動先に応じてステータスと教科の紐づけを更新する。
4. タスクカードのドラッグ＆ドロップはPCのマウス操作とタブレットのタッチ操作の両方で行える。
5. タスクカードをドラッグ中は、移動可能なセルがハイライトされ、無効なセルはドロップ不可であることを視覚的に示す。
5. 各セル内のタスクカードは優先度が高い順に上から表示され、優先度変更時に順序を再計算する。
6. 同一セル内でタスクカードをドラッグ＆ドロップで並び替えた場合、並び順を保存し、次回以降も同じ順序で表示する。
7. タスクカードの優先度や並び順の変更はカンバン上でドラッグ＆ドロップ操作によって行える。
8. タスクカードには日付ごとに実績時間を登録でき、カード上に累積実績時間を表示する。
9. 「明日以降にやる」のセルをクリックして開いたタスクダイアログで新規作成し、既存タスクをクリックすると編集ダイアログを開く。
10. タスクダイアログが開いたとき、カーソルはタイトル入力欄に自動フォーカスされる。
11. タスクダイアログではTabキーでテキストフィールドとボタンを順に移動できる。
12. タスクダイアログには保存・キャンセル・消去ボタンを備え、Escキーでキャンセル、Ctrl+Enterで保存と同等の動作を行う。
13. 「今日やる」ステータスのタスクは、同じ教科内で最優先のタスクのみ「勉強中」に移動できる。
14. 「勉強中」ステータスには常に1件のみタスクを保持し、別タスクを「勉強中」に移動した場合、元のタスクは自動で「一旦休憩」に移動する。
15. 「終わった」へ移動できるのは「勉強中」または「一旦休憩」にあるタスクに限る。
16. 「今日やる」列のタスク合計の予定時間または実績時間が当日の学習可能時間を超える場合、作業をブロックしない非モーダルなアラートを表示し、タスク操作は継続できるようにする。
17. タスクが「勉強中」にある間は経過時間を自動計測し、実績時間に反映する。計測中である旨をカンバン上で非モーダルに表示する。
18. 実績時間はタスクダイアログ内で手動修正できる。
19. 「勉強中」にあるタスクカードは特別な表示とし、学習時間をグラフィカル（例: 円形カウントアップタイマー）に可視化する。
20. ポモドーロタイマー機能を提供し、作業時間と休憩時間を設定・開始・一時停止・リセットできる。タイマーの開始/終了/休憩開始時に非モーダル通知を行う。
21. ポモドーロサイクルに紐づくアラーム機能を提供し、セッション終了時に音または視覚通知を行う。アラームは消音・再通知を選択可能。

### Requirement 3: 進捗可視化とスケジュール管理
**Objective:** 学習者として、優先度と学習負荷を調整するために、進捗とスケジュールを可視化したい。

#### Acceptance Criteria
1. 学習者がダッシュボードを閲覧するとき、学習計画カンバンは1週間スプリントの進捗を教科別・ステータス別に集計して表示する。
2. 期日が7日以内に迫っている場合、学習計画カンバンは該当タスクカードを期限迫近のインジケータで強調表示する。
3. タスクカードが期日を過ぎても完了していない場合、学習計画カンバンは期限超過としてフラグを立て、期限超過リストに表示する。
4. 学習計画カンバンはスプリント期間中の残作業量（タスク数または見積学習時間）を日次でプロットしたバーンダウンチャートを提供する。
5. 学習計画カンバンはカレンダー機能を提供し、月曜日始まり固定でスプリントを選択・切り替えできる。
6. カレンダーでは、指定日について「その日に実施したタスク」「その日が期日のタスク」「その日に追加したタスク」の一覧を確認できる。
7. 設定画面で曜日ごとに作業可能時間を設定でき、デフォルトの学習可能時間として利用する。
8. カレンダーで日付ごとに作業可能時間を上書き設定でき、設定した値をその日の計画に反映する。
9. カレンダーには予定（学習以外のイベントを含む）を登録でき、当該日の学習可能時間に影響を与えるように表示する。
10. カンバン上部（または視認性の高い位置）に当日の予定と作業可能時間の残量を表示する。
11. カンバン上で当日が期日のタスクを視覚的に強調し、他のタスクと区別できるようにする。
12. 学習計画カンバンは教科ごとの完了タスク数と学習時間を週次サマリとして提示し、次スプリント計画の入力に利用できるようにする。
13. スプリント計画（主に日曜）で追加したタスクは、カレンダーの「その日に追加したタスク」一覧には含めず、当日の追加分のみを表示する。
14. 「カンバンの使い方」を案内するヘルプページを用意し、主要な操作（タスク作成・移動、ステータス遷移制約、ダイアログ操作、カレンダー利用、時間設定）を説明する。
15. カレンダーで週ごとおよび日付ごとに学習時間（予定/実績）の推移をグラフィカルに表示する。

### Requirement 4: アプリ基盤とデプロイ・同期
**Objective:** 学習者として、マルチデバイスで途切れずに利用できるよう、PWA・クラウド同期・主要ブラウザ対応を備えた基盤が欲しい。

#### Acceptance Criteria
1. 学習計画カンバンはPWAとしてインストール可能であり、iPad Safari、Google Chrome（PC版）、Microsoft Edge（PC版）で動作する。
2. 学習計画カンバンはGitHub Pagesにデプロイされた環境で利用できる。
3. 学習者がGoogleアカウントでログインしたとき、学習計画カンバンは認証されたGoogle Drive領域にデータを保存する（GitHub Pages配信でも専用サーバ不要で使えるため、本プロジェクトの標準ストレージとする）。
4. 学習計画カンバンはデータをローカルにキャッシュし、オンライン時に随時クラウドへ同期する。
5. オフライン時もカンバン操作とデータ閲覧が可能であり、再接続時に変更をクラウドへアップロードする。
6. 同期状態（同期中/失敗/完了）を非モーダルで通知し、同期失敗時は再試行手段を提供する。
7. アーキテクチャは専用サーバを持たず、GitHub Pages配信とGoogle Drive APIで完結する構成とする。

### Requirement 5: 通知とフィルター
**Objective:** 学習者として、過負荷を防ぎ重要タスクを見逃さないために、通知とフィルターを活用したい。

#### Acceptance Criteria
1. 期日が近いタスクを教科別に集約し、当日と前日にリマインド通知を行う。通知は非モーダルで、操作を妨げない。
2. カンバンとカレンダーは教科・期日・優先度でフィルタリングでき、フィルター適用状態を明示する。

### Requirement 6: 観覧モード（保護者向け）
**Objective:** 保護者として、編集権限なしで最新の学習状況を手元のデバイスから安全に確認したい。

#### Acceptance Criteria
1. 学習者は保護者向けの観覧招待を発行でき、招待は閲覧専用リンクまたはGoogleアカウントでの閲覧権付与で実現する（編集不可）。
2. 観覧モードでは「明日以降にやる」「今日やる」「勉強中」「一旦休憩」「終わった」「やらない」など全ステータスと教科ごとのタスク状態が最新のものとして表示される。
3. 観覧モードはPWAの閲覧専用ビューとして提供し、PC（Chrome/Edge）、iPad Safari、スマートフォンの主要ブラウザで利用できる。
4. 観覧モードはリアルタイムまたは一定間隔で自動更新し、最新のカンバン状態を表示する。オフライン時は最後のキャッシュを表示し、再接続時に自動更新する。
5. 学習者は観覧招待をいつでも無効化でき、無効化後は保護者側から閲覧できない。

## 1週間の利用フロー（ガイドライン）

### スプリント計画・振り返り（日曜）
- カレンダーで翌週スプリントを選択し、前週の週次サマリを確認して教科別の学習量を振り返る。
- 教科行を確認・追加・削除（タスクがある教科は削除不可）。翌週に不要な教科は日曜のうちに整理。
- 「明日以降にやる」のセルからタスク新規作成ダイアログを開き、翌週分のタスクを登録（タイトルにフォーカス、Tabで移動、Ctrl+Enterで保存）。
- 期日と予定時間を設定し、優先度を付与。バーンダウン初期値を確認し、過負荷にならないよう調整。

### 日次運用（月〜金）
- 朝: 「今日やる」に当日のタスクを優先度順に並べ、最優先のみ「勉強中」に移動（「勉強中」は常に1件）。
- 作業開始: 新規タスクは「明日以降にやる」のセルをクリックして追加。着手するタスクを「勉強中」に移動し、既存の「勉強中」は自動で「一旦休憩」へ。
- 学習中: カードをクリックして編集ダイアログを開き、日付ごとに実績時間を追記。TabやEsc、Ctrl+Enterで効率的に操作。
- ステータス移動: 完了したタスクは「勉強中」または「一旦休憩」からのみ「終わった」へ移動。
- 夕方: バーンダウンと教科別の進捗を確認し、遅延があれば優先度を調整。必要に応じて翌日の「今日やる」候補を整理。

### 週末レビュー（土曜または日曜午前）
- カレンダーの日付ビューで「その日に実施したタスク」「期日のタスク」「その日に追加したタスク」を確認。
- 週次サマリで教科別の完了タスク数・予定/実績時間を振り返り、次週の教科構成とタスクを準備（次の「スプリント計画・振り返り」へ接続）。
- 残タスクを整理し、「やらない」「明日以降にやる」へ再配置し、翌週スプリントで扱うものを確定。

### 追加の改善提案
