# Requirements Document

## Introduction
学習目標と学習タスクをカンバン形式で整理し、進捗を可視化・調整することで、計画的な学習を支援する。

## 用語集
| 正式名称 | 略称 | 説明 |
| --- | --- | --- |
| 学習計画カンバン | LPK | 本プロジェクトの学習計画PWA。教科×ステータスでタスクを管理し、1週間スプリントで運用する。 |
| ポモドーロタイマー | PT | 作業時間と休憩時間を設定し計測するタイマー機能。 |
| タスク | Task | 学習者が実施する作業の概念データ（タイトル、期日、予定/実績時間などの属性を持つ）。 |
| タスクカード | TCard | LPK 上に表示される Task の視覚的オブジェクト。ドラッグ&ドロップや表示/編集操作の対象となる。 |
| タスクダイアログ | TDialog | Task の作成・編集を行うダイアログ。Task の全属性を入力・閲覧できる。 |
| ダッシュボード | Dashboard | スプリント進捗や教科別・ステータス別の集計を表示する概要ビュー。 |
| 明日以降にやる | Backlog | 未着手で翌日以降に扱うタスクのステータス。固定列。 |
| 今日やる | Today | 当日中に取り組むタスクのステータス。固定列。 |
| 勉強中 | InPro | 現在進行中のタスクのステータス。固定列。 |
| 一旦休憩 | OnHold | 一時停止中のタスクのステータス。固定列。 |
| 終わった | Done | 完了済みタスクのステータス。固定列。 |
| やらない | WontFix | 今後実施しないタスクのステータス。固定列。 |

## Requirements

### Requirement 1: カンバンボード構造とスプリント管理
**Objective:** 学習者として、全教科の進捗を一目で把握するために、ステータスと教科が整理されたカンバンボードを持ちたい。

#### Acceptance Criteria
1. When LPK がボードを表示するとき, the LPK shall ステータス列（Backlog、Today、InPro、OnHold、Done、WontFix）と教科行による固定の2次元グリッドで単一ボードを構成する。
2. When スプリントを初期化するとき, the LPK shall スプリント長を月曜始まりの1週間に固定し開始日と終了日を表示する。
3. The LPK shall 初期表示をカンバンのみに限定し、メニューまたはアイコンクリック時のみ追加情報を表示する。
4. The LPK shall ステータス列の順序・名称・数を変更不可にロックし、どの画面でも追加/削除や並べ替えを許可しない。
5. The LPK shall 設定画面で各ステータスの表示文字列を設定可能とし、追加・削除・並べ替えは不可とする。
6. While 学習者が設定で教科の並び順を変更するとき, the LPK shall スプリント単位で新しい教科行順を保存しボードに反映する。
7. If 学習者がタスクを含む教科行を削除しようとする, the LPK shall 削除を禁止し理由を通知する。
8. When 学習者がBacklog セルのプラス操作を行う, the LPK shall タスク作成ダイアログを開く。
9. When 学習者が空セルや余白をドラッグする, the LPK shall ボードをスクロールしつつステータスヘッダー行と教科名の左端列を固定表示する。

### Requirement 2: タスクカード作成と編集
**Objective:** 学習者として、学習内容と締切を正確に登録・更新するために、詳細な TCard を扱いたい。

#### Acceptance Criteria
1. When 学習者が新規 TDialog を開く, the LPK shall タイトル・詳細・目標成果・期日・予定時間・実績時間・優先度の入力を受け付け Task として保存する。
2. When 学習者が既存 Task を開く, the LPK shall 現在値を TDialog に読込んで編集を可能にし更新内容を Task として保存する。
3. The LPK shall TCard にタイトル・期日・予定時間・残り時間（予定時間－実績時間の単純差分）を表示し、予定時間/残り時間を全 TCard 共通の体力ゲージ風の棒グラフで可視化し、詳細・実績時間は TDialog で表示する。
4. When TDialog が開く, the LPK shall タイトル入力欄にフォーカスを合わせる。
5. While 学習者が TDialog 内で Tab 操作を行う, the LPK shall テキストフィールドとボタン間で順次フォーカスを移動する。
6. When 学習者が保存をクリックまたは Ctrl+Enter を押下する, the LPK shall Task を保存する; When 学習者がキャンセルをクリックまたは Esc を押下する, the LPK shall 保存せず閉じる。
7. The LPK shall TDialog に保存・キャンセル・消去の操作を提供する。
8. When 学習者が日付ごとに実績時間を記録する, the LPK shall 累積し TDialog で総実績時間を確認できるようにする。
9. Where 学習者が実績時間を調整する必要がある, the LPK shall TDialog 内での手動修正を許可する。

### Requirement 3: タスク移動・優先度・時間管理
**Objective:** 学習者として、学習順序と時間を適切に制御するために、ドラッグ移動と時間計測を一貫したルールで運用したい。

#### Acceptance Criteria
1. When 学習者がTCard をステータス列や教科行間でドラッグ移動する, the LPK shall タスクを移動し新しいステータスと教科の紐づけを保存する。
2. While TCard をドラッグ中, the LPK shall 有効なドロップセルをハイライトし無効なセルを視覚的にブロックする。
3. The LPK shall 各セル内のTCard を優先度の高い順に並べ、優先度変更時に順序を再計算する。
4. When 学習者が同一セル内で並び替える, the LPK shall カスタム順序を保存し次回表示でも維持する。
5. The LPK shall マウス（PC）とタッチ（タブレット）の両方でTCard のドラッグ＆ドロップをサポートする。
6. The LPK shall TCard を横長の長方形として描画し、セル内では優先度順に上から下へ縦方向に積み上げる。
7. Where TCard がInPro ステータスにある, the LPK shall その TCard を正方形で描画し、InPro では常に1件のため縦方向の積み上げは行わない。
8. If 学習者がToday で最優先以外のタスクを同一教科内のInPro へ移動しようとする, the LPK shall 遷移を拒否する.
9. While あるタスクがInPro にある, the LPK shall それを唯一のタスクとして保持し、別タスクが入るときは元のタスクを自動でOnHold へ移動する.
10. If 学習者がInPro またはOnHold 以外からDone へ移動しようとする, the LPK shall 遷移をブロックする.
11. If Today、InPro、OnHold 各列の残り時間合計が当日の学習可能時間を超える, the LPK shall 非モーダルのアラートを表示し操作を継続可能とする。
12. While タスクがInPro にある, the LPK shall 経過時間を自動計測して実績時間に反映し、TCard に予定/残り時間の体力ゲージ風棒グラフと1分ごとに進行する円状プログレスインジケーター（円内に経過時間［分］を表示）を提供する。
13. When 学習者がPT を操作する, the LPK shall 作業/休憩時間の設定と開始・一時停止・リセットを可能にし、開始/終了/休憩開始を非モーダル通知する。
14. Where ポモドーロセッションが終了する, the LPK shall アラーム（音または視覚）を鳴らし消音または再通知を選択可能にする。

### Requirement 4: スケジュール可視化とカレンダー
**Objective:** 学習者として、負荷と期限を調整するために、進捗と予定をまとめて確認したい。

#### Acceptance Criteria
1. When 学習者が Dashboard を開く, the LPK shall 週次スプリントの進捗を教科別・ステータス別に集計表示し、アプリの現在バージョンを表示する。
2. If 今日が期日の Task が Backlog にある, the LPK shall 期限迫近インジケータでカードを強調する。
3. If タスクが期日超過で未完了, the LPK shall 期限超過としてフラグし期限超過リストに掲載する。
4. The LPK shall スプリント中の残作業量（タスク数または見積時間）を日次でプロットするバーンダウンチャートを提供する。
5. The LPK shall 月曜始まり固定のカレンダーでスプリントを選択・切替できるようにする。
6. When 学習者が Google Calendar 連携を有効にする, the LPK shall 選択したカレンダーの予定を取得しカレンダー表示と当日の学習可能時間算出に反映する。
7. When 学習者が LPK のカレンダーに予定を追加または更新する, the LPK shall Google Calendar に双方向同期して反映する（連携が有効な場合）。
8. When 学習者が特定日を閲覧する, the LPK shall 「その日に実施したタスク」「その日が期日のタスク」「その日に追加したタスク」を一覧表示する。
9. Where 曜日ごとの作業可能時間が設定されている, the LPK shall それをデフォルト学習可能時間として適用する。
10. When 学習者が特定日の作業可能時間を上書きする, the LPK shall 当日の計画に上書き値を反映する。
11. Where 学習者が予定（非学習を含む）を登録する, the LPK shall 当日の学習可能時間表示に反映する。
12. The LPK shall カンバン上部など視認性の高い位置に当日の予定と残り学習可能時間を体力ゲージ風の棒グラフで表示する。
13. The LPK shall 教科ごとの完了タスク数と学習時間を週次サマリとして提示し次スプリント計画に利用できるようにする。
14. When 「その日に追加したタスク」を表示するとき, the LPK shall スプリント開始前に追加したタスクを除外し、当日追加分のみ含める。
15. The LPK shall 主要操作（タスク作成・移動、ステータス遷移ルール、ダイアログ操作、カレンダー利用、時間設定）を説明するヘルプページを提供する。
16. When 学習者がカレンダーで週次/日次の学習時間推移を閲覧する, the LPK shall 予定時間と実績時間をグラフで表示する。

### Requirement 5: アプリ基盤・デプロイ・同期
**Objective:** 学習者として、マルチデバイスで途切れず使えるように、PWA・クラウド同期・ブラウザ対応を備えた基盤が欲しい。

#### Acceptance Criteria
1. The LPK shall PWA としてインストール可能であり、iPad Safari・Google Chrome（PC）・Microsoft Edge（PC）で動作する。
2. The LPK shall GitHub Pages へデプロイされた環境で利用可能とする。
3. When 学習者がGoogle にサインインする, the LPK shall 認証済みGoogle Drive 領域にデータを保存し標準ストレージとする。
4. While オンライン接続中, the LPK shall データをローカルにキャッシュし変更を随時クラウドへ同期し、加えて定期的に自動同期を行う。
5. While オフライン, the LPK shall カンバン操作と閲覧を可能にし、再接続時に変更をクラウドへアップロードする。
6. When 同期状態が変化する（同期中/失敗/完了）, the LPK shall 非モーダルで通知し失敗時は再試行手段を提供し、手動同期も実行可能とする。
7. The LPK shall GitHub Pages 配信とGoogle Drive API で完結するサーバレス構成を採用する。
8. The LPK shall デプロイ済みアプリのバージョンを定期的にチェックし、新バージョンが存在する場合は自動でアップデートを適用する。
9. The LPK shall 強制アップデート機能をサポートし、重大更新時はユーザー操作を待たずに最新版へ切り替える。
10. Where Google Drive に保存するデータが複数ファイルになる, the LPK shall 専用ディレクトリを作成し、その中にデータを保存する。
11. The LPK shall アーキテクチャとして将来的にAIや外部アプリからカンバンや設定をAPI経由で操作できる拡張性を備える。

### Requirement 6: 通知・フィルター・閲覧モード
**Objective:** 学習者・保護者として、重要情報を見逃さず安全に共有するために、通知・フィルター・閲覧専用ビューを使いたい。

#### Acceptance Criteria
1. When 期日が接近する（当日および前日）, the LPK shall 教科別に集約した非モーダルのリマインド通知を送る。
2. When 学習者が閲覧招待を発行する, the LPK shall 編集不可の閲覧専用リンクまたはGoogle アカウント権限で閲覧を提供する。
3. The LPK shall 閲覧専用PWA モードをPC（Chrome/Edge）、iPad Safari、主要スマートフォンブラウザで利用可能にする。
4. While 閲覧モードにある, the LPK shall リアルタイムまたは一定間隔で自動更新し、オフライン時は最後のキャッシュを表示して再接続時に自動更新する。
5. If 学習者が閲覧招待を無効化する, the LPK shall 招待先からの閲覧を遮断する。

### Requirement 7: アクセシビリティとローカライゼーション
**Objective:** 障がいを持つユーザーとして、アプリケーションを支障なく利用したい。また、日本人以外のユーザーとして、言語を切り替えて表示したい。

#### Acceptance Criteria
1. The LPK shall WCAG 2.1 AA ガイドラインに準拠する。
2. The LPK shall すべてのインタラクティブな要素に対してキーボードナビゲーションをサポートする。
3. The LPK shall すべてのコンポーネントに適切な ARIA 属性を提供する。
4. The LPK shall UI 言語を日本語と英語で切り替えることを許可する。
5. Where ユーザーが言語を選択する, the LPK shall その設定をローカルに保存し、次回以降の訪問時に適用する。

### Requirement 8: CI/CDとデプロイメント
**Objective:** 開発者として、コードの変更が自動的にテストされ、問題がなければ公開環境にデプロイされる仕組みが欲しい。

#### Acceptance Criteria
1. When コードが`main`ブランチにプッシュされると, the LPK shall 自動的にテストを実行する。
2. If すべてのテストが成功すると, the LPK shall 自動的にビルドを実行する。
3. If ビルドが成功すると, the LPK shall 生成された成果物をGitHub Pagesにデプロイする。
4. The LPK shall デプロイプロセスの状況と結果を開発者に通知する。

### Requirement 9: 開発環境のセットアップ
**Objective:** 開発者として、ホスト環境に依存せず、再現性の高い開発環境を迅速に構築したい。

#### Acceptance Criteria
1. The LPK shall VS Code の Dev Container 機能を利用して、開発環境を構築できること。
2. The LPK shall 必要な依存関係（Node.js, TypeScript など）がプリインストールされている状態を提供すること。
3. The LPK shall 推奨されるVS Code拡張機能（ESLint, Prettier, Copilot など）が自動的にインストールされること。

## 1週間の利用フロー（ガイドライン）

### スプリント計画・振り返り（日曜）
- カレンダーで翌週スプリントを選択し、前週の週次サマリを確認して教科別の学習量を振り返る。
- 教科行を確認・追加・削除（タスクがある教科は削除不可）。翌週に不要な教科は日曜のうちに整理。
- Backlog のセルからタスク新規作成ダイアログを開き、翌週分のタスクを登録（タイトルにフォーカス、Tab で移動、Ctrl+Enter で保存）。
- 期日と予定時間を設定し、優先度を付与。バーンダウン初期値を確認し、過負荷にならないよう調整。

### 日次運用（月〜金）
- 朝: Today に当日のタスクを優先度順に並べ、最優先のみInPro に移動（InPro は常に1件）。
- 作業開始: 新規タスクはBacklog のセルをクリックして追加。着手するタスクをInPro に移動し、既存のInPro は自動でOnHold へ。
- 学習中: カードをクリックして編集ダイアログを開き、日付ごとに実績時間を追記。Tab やEsc、Ctrl+Enter で効率的に操作。
- ステータス移動: 完了したタスクはInPro またはOnHold からのみDone へ移動。
- 夕方: バーンダウンと教科別の進捗を確認し、遅延があれば優先度を調整。必要に応じて翌日のToday 候補を整理。

### 週末レビュー（土曜または日曜午前）
- カレンダーの日付ビューで「その日に実施したタスク」「期日のタスク」「その日に追加したタスク」を確認。
- 週次サマリで教科別の完了タスク数・予定/実績時間を振り返り、次週の教科構成とタスクを準備（次の「スプリント計画・振り返り」へ接続）。
- 残タスクを整理し、WontFix やBacklog へ再配置し、翌週スプリントで扱うものを確定。
